<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Nymi SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<!-- <link href="doxygen.css" rel="stylesheet" type="text/css" /> -->
<link href="customStylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top" bgcolor=#37bec4><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
<tr style="height: 0em;">
  <td id='logoBox'>
  <img  id='logoImg' src ="logo.png"></a>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
			<img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
			<img id="MSearchSelect" src="search/mag_sel.png" alt="">
			<input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorial_hello_nymi.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Hello Nymi </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial we will create a basic <a class="el" href="glossary_nea.html">NEA</a> using the <a class="el" href="glossary_ncl.html">NCL</a> that can communicate with the Nymulator. The NEA will be able to <a class="el" href="glossary_provisioning.html">provision</a> and <a class="el" href="glossary_validation.html">validate</a> <a class="el" href="glossary_nymi.html">Nymis</a>. This sample code and project file is provided in the SDK under the Examples folder for both the Windows and Mac OS X platforms. In Xcode, make sure you are using the HelloNymiNet scheme, not the HelloNymi scheme (check in the top right corner, next to the play and stop buttons). Similar base programs that provide examples of how to get started with the Android and iOS is also available.</p>
<p><br />
 </p><h1>Initialization </h1>
<p>Our program will be written in C++. We'll start the code using some standard libraries, while also including the NCL header file.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;ncl.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
</div><!-- fragment --><p> We also create some global variables that will assist assist us in maintaining application data and state throughout the program</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> gNclInitialized=<span class="keyword">false</span>; </div>
<div class="line"><span class="keywordtype">int</span> gHandle=-1; </div>
<div class="line">std::vector&lt;NclProvision&gt; gProvisions; </div>
</div><!-- fragment --><p> We then create a main function, and the first thing we do is initialize the NCL. Since we will be writing this application to work with the Nymulator, we must first indicate to the NCL library where is the host computer running the Nymulator. This is done using <a class="el" href="group__core_functions.html#gad9ba8cc52bbc5d77d6902559a7ff2b02">nclSetIpAndPort</a> with the following parameters:</p><ol type="1">
<li><code>127.0.0.1</code> is the loopback network connection for your current machine. This address can be set to any computer on the same network running the Nymulator</li>
<li><code>9089</code> is the port that the Nymulator is always listening on.</li>
</ol>
<p>This function is not needed if communicating with a physical Nymi. Once the address of the host computer is set, <a class="el" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a> attempts to kick off some longer-running initializations. By default, the NCL runs in asynchronous mode. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;Welcome to Hello Nymi!\n&quot;</span>;</div>
<div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;Enter \&quot;provision\&quot; if you want to start trusting a new Nymi.\n&quot;</span>;</div>
<div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;Enter \&quot;validate\&quot; if you want to find trusted Nymis and validate the first one found.\n&quot;</span>;</div>
<div class="line">    std::cout&lt;&lt;<span class="stringliteral">&quot;Enter \&quot;quit\&quot; to quit.\n\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="group__core_functions.html#gad9ba8cc52bbc5d77d6902559a7ff2b02">nclSetIpAndPort</a>(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 9089)) <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a>(callback, NULL, <span class="stringliteral">&quot;HelloNymi&quot;</span>, <a class="code" href="group__core_types.html#gga32500a62285dd90003982803d8869aa6a6f8c43af5ca884c0af12134221a94b26">NCL_MODE_DEFAULT</a>, stderr)) <span class="keywordflow">return</span> -1;</div>
</div><!-- fragment --><p> The parameters of <a class="el" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a> mean the following:</p><ol type="1">
<li><code>callback</code>: The function that will be handling all of the callback events, which we will start writing momentarily.</li>
<li><code>NULL</code>: Here we can choose to pass data to our callback. In this example, we don't need this functionality, so we pass NULL.</li>
<li><code>HelloNymi</code>: The name of our NEA that will be provisioned to the Nymi.</li>
<li><code>NCL_MODE_DEFAULT</code>: The mode with which we initialize the NCL.</li>
<li><code>stderr</code>: We will direct NCL error messages to stderr.</li>
</ol>
<p>If <a class="el" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a> returns <a class="el" href="group__core_types.html#gga8b29ab53ed14da3e785ac485cfe885d3aa08f5c833087f263fbe6a3eaecdb1eb6">NCL_FALSE</a> we exit because the host computer is lacking necessary prerequisites, such as a connection to a running Nymulator, Nymi Bluetooth Service, or a supported Low Energy Bluetooth service. When initialization completes, we will receive an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba0d35d2970076d03090254143ac3317ca">NCL_EVENT_INIT</a> callback, which will we handle in our callback function.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> callback(<a class="code" href="struct_ncl_event.html">NclEvent</a> event, <span class="keywordtype">void</span>* userData){</div>
<div class="line">    <a class="code" href="group__core_types.html#ga8b29ab53ed14da3e785ac485cfe885d3">NclBool</a> res;</div>
</div><!-- fragment --><p> The first parameter is the event sent by the NCL, and the second parameter is the custom data we set with <a class="el" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a>, in this case NULL.</p>
<p>We make a switch statement to handle the different types of events that can be received (See <a class="el" href="group__core_types.html#ga3aef10678c713279bbd891e6fba6011b">NclEventType</a>). Since we called <a class="el" href="group__core_functions.html#gaab7a0e4c6676fc35a6f7ef0f09100b57">nclInit</a> we expect to handle the <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba0d35d2970076d03090254143ac3317ca">NCL_EVENT_INIT</a> case; </p><div class="fragment"><div class="line">    <span class="keywordflow">switch</span>(event.<a class="code" href="struct_ncl_event.html#a582e9d5ff7422d1a2dc49d38b4013deb">type</a>){</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba0d35d2970076d03090254143ac3317ca">NCL_EVENT_INIT</a>:</div>
<div class="line">            <span class="keywordflow">if</span>(event.<a class="code" href="struct_ncl_event.html#a6fd83ba946479bd341f7b34670d4d99e">init</a>.<a class="code" href="struct_ncl_event_init.html#aae919d9ea26441d1137e0d6580552df1">success</a>){</div>
<div class="line">                gNclInitialized=<span class="keyword">true</span>;</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;log: init succeeded, getting info\n&quot;</span>;</div>
<div class="line">                <a class="code" href="struct_ncl_info.html">NclInfo</a> info=<a class="code" href="group__core_functions.html#ga2cc56e05f9ad5b40664a52d4640fff84">nclInfo</a>(); </div>
<div class="line">                std::cout&lt;&lt;info.string;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> exit(-1);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> On an init event, we check if the initialization was successful. If it is successful, we set <code>gNclInitialized</code> to true and call <a class="el" href="group__core_functions.html#ga2cc56e05f9ad5b40664a52d4640fff84">nclInfo</a> to print out the NCL initialization configuration. If the initialization was not successful, we exit.</p>
<p>After a successful initialization, an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bad429fcb36cf410b96b41a32bdbfd97b3">NCL_EVENT_ERROR</a> can be thrown and must be handled. Such errors can be due to Bluetooth's availability stopped. To keep it simple, this program will simply perform a hard exit. </p><div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bad429fcb36cf410b96b41a32bdbfd97b3">NCL_EVENT_ERROR</a>:</div>
<div class="line">            exit(-1);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> Next, looking at the remaining of the main function, we create a main loop that will poll for the user input. We create a simple guard to ensure that no commands are processed until the NCL has been initialized.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">while</span>(<span class="keyword">true</span>){</div>
<div class="line">        std::string input;</div>
<div class="line">        std::cin&gt;&gt;input; </div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(!gNclInitialized){</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;error: NCL didn&#39;t finished initializing yet!\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
</div><!-- fragment --><p> <br />
 </p><h1>Provisioning </h1>
<p>Provisioning the Nymi is the first Nymi-to-NEA communication task. This task pairs a Nymi to an NEA and is only needed to be performenced once per Nymi.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">if</span>(input==<span class="stringliteral">&quot;provision&quot;</span>){</div>
<div class="line">            <a class="code" href="group__core_types.html#ga8b29ab53ed14da3e785ac485cfe885d3">NclBool</a> res=<a class="code" href="group__negotiation_functions.html#ga8b00c2e459aac27f86c16fad884610ce">nclStartDiscovery</a>();</div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Discovery started successfully\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Dsicovery failed to start\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p> This case calls <a class="el" href="group__negotiation_functions.html#ga8b00c2e459aac27f86c16fad884610ce">nclStartDiscovery</a> , which will put the NEA in discovery mode. This means that it will be able to discover any Nymi that is in provisioning mode. When a provisioning Nymi is discovered, an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bac63c43d3ad37f7d2fd4ff6a1678a4de5">NCL_EVENT_DISCOVERY</a> is sent to our callback function.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bac63c43d3ad37f7d2fd4ff6a1678a4de5">NCL_EVENT_DISCOVERY</a>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;log: Nymi discovered\n&quot;</span>;</div>
<div class="line">            res=<a class="code" href="group__negotiation_functions.html#ga825ba39e62b86781e8e0f36fbd8c87c6">nclStopScan</a>();  </div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Stopping Scan successful\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Stopping Scan failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            gHandle=<span class="keyword">event</span>.discovery.nymiHandle;</div>
<div class="line">            res=<a class="code" href="group__negotiation_functions.html#ga75efc81655ffa0b171ec77f73fb8c95c">nclAgree</a>(gHandle); </div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Agree request successful\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Agree request failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> In our application, we process <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bac63c43d3ad37f7d2fd4ff6a1678a4de5">NCL_EVENT_DISCOVERY</a> with the assumption that the first discovered Nymi is the Nymi we want to provision. Subsequently, we stop the discovery process by calling <a class="el" href="group__negotiation_functions.html#ga825ba39e62b86781e8e0f36fbd8c87c6">nclStopScan</a> then proceed to communicate with the Nymi by calling <a class="el" href="group__negotiation_functions.html#ga75efc81655ffa0b171ec77f73fb8c95c">nclAgree</a>. This function will establish a <a class="el" href="glossary_connection.html">connection</a> with the discovered Nymi and produce an LED pattern on the Nymi. When using the physical Nymi, this may take a few seconds before the pattern is displayed.</p>
<p>In cases where we do not wish to connect to the first discovered Nymi, you can use the RSSI value of the filter through the devices based on approximiate proximity.</p>
<p>If an agreement with the desired Nymi completes succesfully, an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bace67ca079d7623054f69616274953dcf">NCL_EVENT_AGREEMENT</a> is sent to the callback function.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011bace67ca079d7623054f69616274953dcf">NCL_EVENT_AGREEMENT</a>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;Is this:\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i&lt;<a class="code" href="group__negotiation_constants.html#ga6545350a1d021fb6923c4e7999f796b7">NCL_AGREEMENT_PATTERNS</a>;++i){</div>
<div class="line">                <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> j=0; j&lt;<a class="code" href="group__negotiation_constants.html#ga73d7fd893995113ea91c2fdeca990c74">NCL_LEDS</a>; ++j)</div>
<div class="line">                    std::cout&lt;&lt;event.<a class="code" href="struct_ncl_event.html#ae964977939f1e63d5a0524e49400ba37">agreement</a>.<a class="code" href="struct_ncl_event_agreement.html#a79e0ca7052f56d6cc951f65ba7ca990c">leds</a>[i][j];</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;the correct LED pattern (agree/reject)?\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> We print the LED pattern to the console for the user to confirm that the same pattern appears on the Nymi. It is recommended to have the user explicitly agree or reject this pattern, however in the case that the NEA does not have a display user confirmation can be skipped. However, there is no guarantee on which Nymi was just provisioned in a multiple Nymi environment.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(input==<span class="stringliteral">&quot;agree&quot;</span>){</div>
<div class="line">            <a class="code" href="group__core_types.html#ga8b29ab53ed14da3e785ac485cfe885d3">NclBool</a> res=<a class="code" href="group__negotiation_functions.html#ga520df0b15a95ec8bfc52a64c5db217b8">nclProvision</a>(gHandle, <a class="code" href="group__core_types.html#gga8b29ab53ed14da3e785ac485cfe885d3aa08f5c833087f263fbe6a3eaecdb1eb6">NCL_FALSE</a>);</div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Provision request successful\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Provisioning failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(input==<span class="stringliteral">&quot;reject&quot;</span>){</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="group__negotiation_functions.html#gacf1345da6ce70ca18d044babe3c65c71">nclDisconnect</a>(gHandle)){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Disconnection Failed!\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p> If user enters "agree" the remaining provisioning process is performed by calling <a class="el" href="group__negotiation_functions.html#ga520df0b15a95ec8bfc52a64c5db217b8">nclProvision</a>. If the user "reject" because the LED patterns do not match, this would indicate the the NEA is not communicating with the correct Nymi, and should disconnect before finalizing the provisioning process.</p>
<p>If the provision is successful, we will receive <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba6ebcb291ed57474ed99890e8efd544f0">NCL_EVENT_PROVISION</a> in the callback. We will store the new provision in a global variable <code>gProvisions</code>. </p><div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba6ebcb291ed57474ed99890e8efd544f0">NCL_EVENT_PROVISION</a>:</div>
<div class="line">            gProvisions.push_back(event.<a class="code" href="struct_ncl_event.html#a429c7e66a53f3ebdbe0c5dcc47359540">provision</a>.<a class="code" href="struct_ncl_event_provision.html#a22c201897d9145e04c1b69415d91214d">provision</a>);</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;log: provisioned\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> At the end of provisioning, the Nymi will automatically disconnect from the NEA, and the callback will reive an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba169f0c1c332a8d036691ba85525da51a">NCL_EVENT_DISCONNECTION</a>. At this point, you have successfully provisioned your NEA to the Nymi.</p>
<p><br />
 </p><h1>Validation </h1>
<p>After provisioning a Nymi, the most imporant functionality of the NEA is the ability to reconnect to that previously provisioned device. This entire process is coined validation. An NEA that validated a Nymi has access to a slew of other Nymi functionalities, including <a class="el" href="group__streams.html">Streams</a> and <a class="el" href="group__security.html">Security Tools</a>.</p>
<p>The first step is <a class="el" href="glossary_finding.html">finding</a> the previously provisioned Nymi. Finding is similar to discovery but is more directed for finding provisioned Nymis. <a class="el" href="group__negotiation_functions.html#ga4ca57669bd223a1395b80b206fb71e89">nclStartFinding</a> only find specified Nymis in the immediate area, and does not establish any connection.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(input==<span class="stringliteral">&quot;validate&quot;</span>){</div>
<div class="line">            <a class="code" href="group__core_types.html#ga8b29ab53ed14da3e785ac485cfe885d3">NclBool</a> res=<a class="code" href="group__negotiation_functions.html#ga4ca57669bd223a1395b80b206fb71e89">nclStartFinding</a>(gProvisions.data(), gProvisions.size(), <a class="code" href="group__core_types.html#gga8b29ab53ed14da3e785ac485cfe885d3aa08f5c833087f263fbe6a3eaecdb1eb6">NCL_FALSE</a>);</div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Finding started successfully\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Finding failed to start\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p> The parameters mean the following:</p><ol type="1">
<li><code>gProvisions.data()</code>: The set of previously provisioned Nymis</li>
<li><code>gProvisions.size()</code>: The number of provisions in the data set</li>
<li><code>NCL_FALSE</code>: Do not <a class="el" href="glossary_detection.html">detect</a> Nymis</li>
</ol>
<p>When a provisioned Nymi is found, we receive <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba10b2ad405430ac6efa145f35f0711d43">NCL_EVENT_FIND</a> in the callback.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba10b2ad405430ac6efa145f35f0711d43">NCL_EVENT_FIND</a>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;log: Nymi found\n&quot;</span>;</div>
<div class="line">            res=<a class="code" href="group__negotiation_functions.html#ga825ba39e62b86781e8e0f36fbd8c87c6">nclStopScan</a>(); </div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Stopping Scan successful\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Stopping Scan failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            gHandle=<span class="keyword">event</span>.find.nymiHandle;</div>
<div class="line">            res=<a class="code" href="group__negotiation_functions.html#ga7db0235691855d0590a9bc6e9e55496c">nclValidate</a>(gHandle); </div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Validate request successful\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Validaterequest failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> When a find event is received, we immediately stop scanning, and start the validation process with the given Nymi handle. <a class="el" href="group__negotiation_functions.html#ga7db0235691855d0590a9bc6e9e55496c">nclValidate</a> establishes a connection with the Nymi and performs a handshaking to ensure that the connected Nymi is actually the previously provisioned Nymi.</p>
<p>If the Nymi is validated, <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba465a5e4c2c3a8122843a09ce405a6a16">NCL_EVENT_VALIDATION</a> will be sent to the callback.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba465a5e4c2c3a8122843a09ce405a6a16">NCL_EVENT_VALIDATION</a>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;Nymi validated! Now trusted user requests can happen, such as request Symmetric Keys!\n&quot;</span>;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> After receiving this event, the Nymi is now validated and requests for Nymi functionalities can start, such as request for Global Signature Key Pair</p>
<p><br />
 </p><h1>Disconnecting </h1>
<p>It is expected for the NEA to only connect when needed, then disconnect when it no longer needs the Nymi's services. This is handled with the <a class="el" href="group__negotiation_functions.html#gacf1345da6ce70ca18d044babe3c65c71">nclDisconnect</a> command. This is a hard command that can be called whenever to immediately end the connection with the Nymi.</p>
<div class="fragment"><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(input==<span class="stringliteral">&quot;disconnect&quot;</span>){</div>
<div class="line">            <span class="keywordflow">if</span>(gHandle==-1){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;NEA Not connected to a Nymi. Cannot Disconnect\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <a class="code" href="group__core_types.html#ga8b29ab53ed14da3e785ac485cfe885d3">NclBool</a> res=<a class="code" href="group__negotiation_functions.html#gacf1345da6ce70ca18d044babe3c65c71">nclDisconnect</a>(gHandle);</div>
<div class="line">            <span class="keywordflow">if</span>(res){</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Disconnection request successfull\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                std::cout&lt;&lt;<span class="stringliteral">&quot;Disconnection failed\n&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
</div><!-- fragment --><p> This function will throw an <a class="el" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba169f0c1c332a8d036691ba85525da51a">NCL_EVENT_DISCONNECTION</a> which is handled in the callback function</p>
<div class="fragment"><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__core_types.html#gga3aef10678c713279bbd891e6fba6011ba169f0c1c332a8d036691ba85525da51a">NCL_EVENT_DISCONNECTION</a>:</div>
<div class="line">            std::cout&lt;&lt;<span class="stringliteral">&quot;log: disconnected\n&quot;</span>;</div>
<div class="line">            gHandle=-1; </div>
<div class="line">            <span class="keywordflow">break</span>;</div>
</div><!-- fragment --><p> This function primarily resets the Nymi handle to indicate that a connection does not exist.</p>
<p><br />
 </p><h1>Cleanup </h1>
<p>When the user no longer needs Nymi communication, we need to cleanup everything;</p>
<div class="fragment"><div class="line">    <a class="code" href="group__core_functions.html#gae9b1705fe263a7cd31e82cde14917119">nclFinish</a>(); </div>
<div class="line">    <span class="keywordflow">return</span> 0; </div>
<div class="line">}</div>
</div><!-- fragment --><p> We check for a connected Nymi, and if there is one, we disconnect from it. Then we call <a class="el" href="group__core_functions.html#gae9b1705fe263a7cd31e82cde14917119">nclFinish</a> to end our communication with the Bluetooth hardware, and we're done! </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<!--   <ul>
    <li class="footer">Copyright Bionym 2013. Generated on Thu Dec 18 2014. Version 0.1.0</li>
  </ul> -->
</div>
<!-- end header part -->
